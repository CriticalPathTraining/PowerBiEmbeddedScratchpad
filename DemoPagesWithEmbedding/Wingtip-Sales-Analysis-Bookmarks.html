<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="utf-8" />
  <title>Navigating with Bookmarks</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link href="css/app.css" rel="stylesheet" />
  <script src="scripts/jquery.js"></script>
  <script src="scripts/powerbi.js"></script>
</head>

<body style="margin:0;padding:0;background-color:#EEE;">

  <div id="leftnav" style="float:left; width:240px;">

    <h3>Bookmarks</h3>

    <div id="loading">
      <img title="Loading..." src="css/img/loading.gif" style="width:80px;margin-top:36px;margin-left:72px;" />
    </div>

    <div id="leftnav-menu">
      <ul id="page-navigation"></ul>
    </div>

  </div>

  <div id="embedContainer" style="margin-left: 260px;" />

  <script>

    // data required for embedding Power BI report
    var embedReportId = "f10c9de9-a325-4a43-af9f-0cf35cca2ab7";
    var embedUrl = "https://app.powerbi.com/reportEmbed?reportId=f10c9de9-a325-4a43-af9f-0cf35cca2ab7&groupId=4baab6c0-87c5-4a2a-a73e-1f97adcc6bdb";
    var accessToken = "H4sIAAAAAAAEAC2Wx8rEXJJE3-XfakBeKg30Qr7kvd1JJe-uvGvm3eej6WVCQAZBEnn-_Y-dPQPIin_-95_Bl-2xUnCr__S94c4i6ncVA4E9z5_n6Yss_ChSHacvPCRnsdUk_Ybq35zUQBhP2iar54ahSWHTXVcAk-qeQ0ryOvg_62HVoeoD07WjwH2uGHKJL9wHvSd9bULcwIFkXhNPyptzfkoz4cZLpPpRkZnhDrBJbufqsIK3QP6sWzJuinWS1y5ONoPuVslV5EOh66cBOWOhpi0Tl0e-6zTqthNZo5u5ywoxSYAOq1iQGEYz4KLOaT-bYmhQ_pNUynXGXLiibYTMkbiRJOJeZXGgkYGsii7lmUs7Qlwp3HKHm3Xvo6SmQ_RS39VGvUHJwDyY71v4CjEYEnOCHOQ6GULbfBJR8XwgXfJGPBiCu5P1CB2HgPWsaTTeUivlYoOqAL9691HdlDG2qhI2W7J3H7JK2cXN9v3mUKmdVsnbkBCBGpSU7rCM0bHy1oWYr-hGgrPXVG73wUTxa6rc95zT7aM7JjEGao40YCyc_stKgJN93AFrtndr9NMx-yFmCvYUVyXkzccnXwH5gV7CUtXWajAEOkrPYgnCr10N360quEzWgOG5ZBu3_rBqDFUHyA5Y4R2Stv-lK38PGkosVkLUp0oBPa3VgBO-ATWptlPQ9w1tftIwi0HiZO5vkIq5utFnjo4fRvbUyVZ8l0DqRtr0KstL3GVwS9fP_Vuhd99RKFgV4UauZ9DVB5-mKEcadVl0te7Y9TelM_F5Ml8O16NB3Z_7ns5t2SZK3XqSRlWslhvO3VWoQ5oZzngPUwjHPFgVeHRXPxlbx-KSgvqN9XakSUhT5c8inhSvi5VA2d8P23sdmBqIMkqd8H_EcZRLrtMeWcLJpbFm7zkw8cBtLr2BATIpZm1dMBDRQ9q5iVLmRH7B_H4cYDN80qxJ_bnRn7Z7e9lWLtoz8GFr0b4Hix91JPTkmBO6SMRBH3WHDOiFsOxF9O3Er0PL7nrN0ATGGu3iGgzGDfSGNYnxsGjeNL5HARTVHM4y5Z_pHduY1FliZ6A3UGXOgzMK20D4zTfmqqlZse-tLCeu8lbiaRgHzdtcvy6-FVnEKjes8p6QbrPPSPelsD4m046Ywfh8rHU2FJzUYrsWgjk0oR-1VY0rDUCdYYkvlZAW0YAuOuUoXEE0aL3ogqSHLttqJ4j4zFm8PnvWcsy2cyjn0i79OYlFtIxfTZ73b7ISZk4MhzP2Yz_bjDrvyZD7i3isPJ_16iiRF5oI953rKi_KkhzIdCiST80fW6V7RiG9TRjwqLBSnvKJEQ6EO3aFMq6WywK03imBcVzlNc-sZwjEbviYjWPvYUrDLvvK8GTGrlvd4S58fvSd-34t9_NVZUq7oPtzz25nebBeIOpx82SKJst6uapeXmZ2kYlRe4Qmutk9Pr7tMUV3dN_tTzYjKtImlMX6sUwYWqSK7IqY7BnLRVAhozTE3ND2O7e0j10RbIDKBorSq8S9LqMEcslq8I6YnMLdD1_RqRyZhIsMqB2pQRTG08KI8jn7_WRYhKYUYpcp0p6tYbLBpr9xT9-qytQs0Qqa35x4pk_Iflxt5s8QGaq-0PGOnlr8Jja8s2omYxt1fdkKYNzzdU9oYS9wrPIONdUH2K33O0zQKo9TWpL5Q_h5zO0Dgi4PC3dHJOuQiCHt_RZVOEIw55Q_Hfpl5hZv1t73-SXbadpBy0pjso3qevN6CTe8qL93EmolPGzqDW4Kkjs8cChjUj9pDCuFD4kW8CqrcXRatlWxxhf7uxJHm_PHbb5CMGbz8IstHjhHzQYTnKfglLIi5Rv5_PAap7nGHABBoVHdrJFCbMMKaxPrbradiA_L0kX_cRTZuxU-FRma6etLy44WLsYNRZmmqtkb8hqlXjW84GCukypNmk5DXAfYJk8bi6vVYQ-880KYdg_12-L72n0AEjwieg0A5K6fDMWIoPuRUq2DMuW-Y-0b9P1GTQVReaORfi8lERFGQ5faBc8FG0_YKSfw2pS4xaUOZJtbrnq0ZZmcw7RNUtXQIZHvXaSzWBGL4GOl8npamktgNU-gP8BXPDwJEKskJ_7AN_MiFNz8kpySrQRCXQiOvNd2-iUchFW-dSAgoYXGL1N_pPb3QDDym_DnFkr8aY3L_HOCQQXiAgHu7AfudoekwwmFfkUZgzWUpAclZv5y0etf__rnf_7h12fegVY-f5ghQTgaRB_Mk1uZwwIeMWxd0sRy2NO0tAI9MX4NxBO1VCnJ30ZPHL81myw6-9fbvbytaYLq6tdyzIqycpL1gHNdDgMFGCKennZjf5SAIF98JvY4Z7Xat5JwFGfgFBRVLJZohMx897Xb0_FnrEgQLKh1ut_mg7y7gPzy8axGYZVf4NJLNfect5TUMHihnYYqYO1gH2MC-gYW9vsgQTgF-nWN9sJNTqD1wkYaGIRM9KRHe7f9-BYfbwZtLukef2f5jLDw-2vtY4voKUcdg5bP0hvokRGBx1HJXU9TKE_lrsJp-hbdtqKkJUmkvuAI0QK0ZjjowfskOFlCx3La1f4-sWC0jV__N-ZnbspVCf9S_uQQPI_Spq7Fds1jEbH3r3T-o_Laesr2Yy3_ZI8oQtZnac5o-AlShOKcMqIvA75SHgxSn-5qAo_FtNyNQg4WZxpGyy2DhZBI-IdqE6Kx1NLFLrdEzj7jIiYcHo2Sa6MhqIZovfZdZbjI8ueDnwRyMpCG1qhDwfPsu1he5uYv-vGry1VQ2xd3FxivOjNU6c_BO7KFTZdERzzaDrpuJZRgaBv8QeQiXHg8yAh6IbRuvrfiLviaNB7xRNp2e9tS13xhVAGIOXFTwqdB87WeXYfSO6X1s4L5HcOv_0NGZUGnz27LqjnQQ72ISStfvB2jT7VKlpCUo31gO9grcdUBI8div2vmu6EqJa9Oom_0M30FQZFBfBdGbb58vyEOI2Nj_Rfz__0_miwQtloLAAA=";

    // Get models object to access enums for embed configuration
    var models = window['powerbi-client'].models;

    var config = {
      type: 'report',
      id: embedReportId,
      embedUrl: embedUrl,
      accessToken: accessToken,
      tokenType: models.TokenType.Embed,
      permissions: models.Permissions.All,
      viewMode: models.ViewMode.View,
      settings: {
        filterPaneEnabled: false,
        navContentPaneEnabled: false,
      }
    };

    // Get a reference to the embedded report HTML element
    var embedContainer = document.getElementById('embedContainer');

    // Embed the report and display it within the div container.
    var report = powerbi.embed(embedContainer, config);



    $("#loading").show();

    var bookmarks;
    var bookmarksManager;
    var currentBookmark;

    report.on('loaded', function () {
      $("#loading").hide();      
      console.log(report.bookmarksManager);
      bookmarksManager = report.bookmarksManager;
      report.bookmarksManager.getBookmarks().then(
        function (reportBookmarks) {
          bookmarks = reportBookmarks;
          loadBookmarks(bookmarks);
        });
    });

    var loadBookmarks = function (bookmarks) {
      console.log(bookmarks);
      report.bookmarksManager.play();
      var pageNavigation = $("#page-navigation");
      pageNavigation.empty();

      for (var index = 0; index < bookmarks.length; index++) {
        var bookmarkDisplayName = bookmarks[index].displayName;
        pageNavigation.append($("<li>")
          .append($('<a href="javascript:;" >')
            .text(bookmarks[index].displayName))
          .click(function (domEvent) {
            var bookmarkDisplayName = domEvent.target.textContent ? domEvent.target.textContent : domEvent.target.firstChild.textContent;
            var bookmark = bookmarks.find((bookmark) => { return bookmark.displayName === bookmarkDisplayName });
            report.bookmarksManager.apply(bookmark.name);
          }));
      }
    }


    $(function () {
      var widthBuffer = 272;
      var heightBuffer = 18;
      $("#embedContainer").width($(window).width() - widthBuffer);
      $("#embedContainer").height($(window).height() - heightBuffer);
      $("#leftnav").height($(window).height() - heightBuffer);
      $(window).resize(function () {
        $("#embedContainer").width($(window).width() - widthBuffer);
        $("#embedContainer").height($(window).height() - (heightBuffer));
        $("#leftnav").height($(window).height() - heightBuffer);
      });
    });



  </script>

</body>
</html>